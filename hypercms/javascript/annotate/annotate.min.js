var annotatestatus=!1;!function(t){"use strict";function o(o,e){this.options=e,this.$el=t(o),this.clicked=!1,this.fromx=null,this.fromy=null,this.fromxText=null,this.fromyText=null,this.tox=null,this.toy=null,this.points=[],this.storedUndo=[],this.storedElement=[],this.images=[],this.img=null,this.selectedImage=null,this.currentWidth=null,this.currentHeight=null,this.selectImageSize={},this.compensationWidthRate=1,this.zoomfactor=1,this.penmouse=0,this.linewidth=1,this.fontsize=1,this.init()}o.prototype={init:function(){var o=this;o.linewidth=o.options.linewidth,o.fontsize=o.options.fontsize,o.$el.addClass("annotate-container"),o.$el.css({cursor:"crosshair"}),o.baseLayerId="baseLayer_"+o.$el.attr("id"),o.drawingLayerId="drawingLayer_"+o.$el.attr("id"),o.toolOptionId="tool_option_"+o.$el.attr("id"),o.$el.append(t('<canvas id="'+o.baseLayerId+'"></canvas>')),o.$el.append(t('<canvas id="'+o.drawingLayerId+'"></canvas>')),o.baseCanvas=document.getElementById(o.baseLayerId),o.drawingCanvas=document.getElementById(o.drawingLayerId),o.baseContext=o.baseCanvas.getContext("2d"),o.drawingContext=o.drawingCanvas.getContext("2d"),o.baseContext.lineJoin="round",o.drawingContext.lineJoin="round";var e="btn-group",i="";"left"!==o.options.position&&"right"!==o.options.position||(e="btn-group-vertical",i="btn-block");var n=window.navigator.userAgent,s=n.indexOf("MSIE "),a=n.indexOf("Trident"),h=n.indexOf("Edge");if(s>-1||a>-1||h>-1)var l=!0;else l=!1;o.options.bootstrap?(o.$tool='<div id="" class="btn-group" role="group" ><div class="'+e+'" data-toggle="buttons"><button id="undoaction" title="Undo the last annotation" class="btn btn-primary '+i+' annotate-undo"> <span class="glyphicon glyphicon-arrow-left"></span></button>',o.options.unselectTool&&(o.$tool+='<label class="btn btn-danger active"><input type="radio" name="'+o.toolOptionId+'" data-tool="null" data-toggle="tooltip" data-placement="top" title="No tool selected"><span class="glyphicon glyphicon-ban-circle"></span></label>'),o.$tool+='<label class="btn btn-primary active"><input type="radio" name="'+o.toolOptionId+'" data-tool="rectangle" data-toggle="tooltip" data-placement="top" title="Draw an rectangle"> <span class="glyphicon glyphicon-unchecked"></span></label><label class="btn btn-primary"><input type="radio" name="'+o.toolOptionId+'" data-tool="circle" data-toggle="tooltip"data-placement="top" title="Write some text"> <span class="glyphicon glyphicon-copyright-mark"></span></label><label class="btn btn-primary"><input type="radio" name="'+o.toolOptionId+'" data-tool="text" data-toggle="tooltip"data-placement="top" title="Write some text"> <span class="glyphicon glyphicon-font"></span></label><label class="btn btn-primary"><input type="radio" name="'+o.toolOptionId+'" data-tool="arrow" data-toggle="tooltip" data-placement="top" title="Draw an arrow"> <span class="glyphicon glyphicon-arrow-up"></span></label><label class="btn btn-primary"><input type="radio" name="'+o.toolOptionId+'" data-tool="pen" data-toggle="tooltip" data-placement="top" title="Pen Tool"> <span class="glyphicon glyphicon-pencil"></span></label><button type="button" id="redoaction" title="Redo the last undone annotation"class="btn btn-primary '+i+' annotate-redo"> <span class="glyphicon glyphicon-arrow-right"></span></button></div></div>'):(o.$tool='<div id="annotationToolbar" style="display:inline-block; margin-top:-4px; margin-left:-13px; white-space:nowrap; min-width:500px;">',o.options.unselectTool&&(o.$tool+='<div class="hcmsToolbarBlock" style="white-space:nowrap;"><div class="hcmsButton hcmsButtonActive hcmsButtonSizeSquare" id="tool0"><label style="display:inline-block; float:left; margin-top:-16px; cursor:pointer;"><input type="radio" style="float:left; visibility:hidden" name="'+o.toolOptionId+'" data-tool="null" checked /><img id="annotationStop" src="" class="hcmsButtonSizeSquare" style="pointer-events:none; float:left;" /></label></div></div>'),o.$tool+='<div class="hcmsToolbarBlock" style="white-space:nowrap;"><div class="hcmsButton hcmsButtonSizeSquare" id="tool1"><label style="display:inline-block; float:left; margin-top:-16px; cursor:pointer;"><input type="radio" style="float:left; visibility:hidden" name="'+o.toolOptionId+'" data-tool="rectangle" /><img id="annotationRectangle" src="" class="hcmsButtonSizeSquare" style="pointer-events:none; float:left;" /></label></div><div class="hcmsButton hcmsButtonSizeSquare" id="tool2"><label style="display:inline-block; float:left; margin-top:-16px; cursor:pointer;"><input type="radio" style="float:left; visibility:hidden" name="'+o.toolOptionId+'" data-tool="circle" /><img id="annotationCircle" src="" class="hcmsButtonSizeSquare" style="pointer-events:none; float:left;" /></label></div><div class="hcmsButton hcmsButtonSizeSquare" id="tool3"><label style="display:inline-block; float:left; margin-top:-16px; cursor:pointer;"><input type="radio" style="float:left; visibility:hidden" name="'+o.toolOptionId+'" data-tool="text" /><img id="annotationText" src="" class="hcmsButtonSizeSquare" style="pointer-events:none; float:left;" /></label></div><div class="hcmsButton hcmsButtonSizeSquare" id="tool4"><label style="display:inline-block; float:left; margin-top:-16px; cursor:pointer;"><input type="radio" style="float:left; visibility:hidden" name="'+o.toolOptionId+'" data-tool="arrow" /><img id="annotationArrow" src="" class="hcmsButtonSizeSquare" style="pointer-events:none; float:left;" /></label></div>',0==l&&(o.$tool+='<div class="hcmsButton hcmsButtonSizeSquare" id="tool5"><label style="display:inline-block; float:left; margin-top:-16px; cursor:pointer;"><input type="radio" style="float:left; visibility:hidden" name="'+o.toolOptionId+'" data-tool="pen" /><img id="annotationPen" src="" class="hcmsButtonSizeSquare" style="pointer-events:none; float:left;" /></label></div>'),o.$tool+='</div><div class="hcmsToolbarBlock" style="white-space:nowrap;">',0==l&&(o.$tool+='<div id="download" class="hcmsButton hcmsButtonSizeSquare"><img id="annotationDownload" src="" class="hcmsButtonSizeSquare" /></div>'),o.$tool+='</div><div class="hcmsToolbarBlock" style="white-space:nowrap;"><div id="undoaction" class="annotate-undo hcmsButtonOff hcmsButtonSizeSquare"><img id="annotationUndo" src="" class="hcmsButtonSizeSquare" /></div><div id="redoaction" class="annotate-redo hcmsButtonOff hcmsButtonSizeSquare"><img id="annotationRedo" src="" class="hcmsButtonSizeSquare" /></div></div><div id="zoomlayer" class="hcmsToolbarBlock" style="white-space:nowrap; display:none;"><div id="zoomaction" style="vertical-align:center; line-height:36px;"><select id="annotationZoom" name="annotationZoom"><option value=\'1\' selected>100%</option><option value=\'0.75\'>75%</option><option value=\'0.5\'>50%</option></select></div></div><div class="hcmsToolbarBlock" style="white-space:nowrap;"><div id="help" class="hcmsButtonBlank hcmsButtonSizeSquare"><img id="annotationHelp" src="" class="hcmsButtonSizeSquare" /></div></div></div>'),o.$tool=t(o.$tool),t(".annotate-container").append(o.$tool);var r=o.$el.offset();"top"===o.options.position||"top"!==o.options.position&&!o.options.bootstrap?o.$tool.css({position:"absolute",top:-35,left:r.left}):"left"===o.options.position&&o.options.bootstrap?o.$tool.css({position:"absolute",top:r.top-35,left:r.left-20}):"right"===o.options.position&&o.options.bootstrap?o.$tool.css({position:"absolute",top:r.top-35,left:r.left+o.baseCanvas.width+20}):"bottom"===o.options.position&&o.options.bootstrap&&o.$tool.css({position:"absolute",top:r.top+o.baseCanvas.height+35,left:r.left}),o.$textbox=t('<textarea id="" style="resize:none; position:absolute; z-index:100000; display:none; top:0; left:0; background:transparent; border:1px dotted; line-height:25px; ;font-size:'+o.fontsize+";font-family:sans-serif; color:"+o.options.color+';word-wrap:break-word; outline-width:0; overflow:hidden; padding:0px;"></textarea>'),t("body").append(o.$textbox),o.options.images?o.initBackgroundImages():(o.options.width||o.options.height||(o.options.width=640,o.options.height=480),o.baseCanvas.width=o.drawingCanvas.width=o.options.width,o.baseCanvas.height=o.drawingCanvas.height=o.options.height),o.$tool.on("change",'input[name^="tool_option"]',function(){clickevent="annotate";for(var e,i=document.getElementById("annotationToolbar").getElementsByClassName("hcmsButton"),n=0;n<i.length;n++)(e=i[n].classList).contains("hcmsButtonActive")&&e.remove("hcmsButtonActive");t(this).parent().parent().addClass("hcmsButtonActive"),o.selectTool(t(this))}),o.$tool.on("change",'select[name^="annotationZoom"]',function(){o.zoomaction(t(this).val())}),t('[data-tool="'+o.options.type+'"]').trigger("click"),o.$tool.on("click",".annotate-redo",function(t){o.redoaction(t)}),o.$tool.on("click",".annotate-undo",function(t){o.undoaction(t)}),t(document).on(o.options.selectEvent,".annotate-image-select",function(e){e.preventDefault();var i=o.selectBackgroundImage(t(this).attr(o.options.idAttribute));o.setBackgroundImage(i)}),t("#"+o.drawingLayerId).on("mousedown touchstart",function(t){o.annotatestart(t)}),t("#"+o.drawingLayerId).on("mouseup touchend",function(t){o.annotatestop(t)}),t("#"+o.drawingLayerId).on("mouseleave touchleave",function(t){o.annotateleave(t)}),t("#"+o.drawingLayerId).on("mousemove touchmove",function(t){o.annotatemove(t)}),t(window).on("resize",function(){o.annotateresize()}),o.checkUndoRedo(),clickevent=""},generateId:function(t){var o="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz".split(""),e=o.length;t||(t=Math.floor(Math.random()*e));for(var i="",n=0;n<t;n++)i+=o[Math.floor(Math.random()*e)];return i},addElements:function(t,o,e){this.storedElement=t,this.clear(),this.redraw()},pushImage:function(t,o,e){var i=null,n=null;if("object"==typeof t?(i=t.id,n=t.path):(i=t,n=t),""===i||void 0===i||this.selectBackgroundImage(i))for(i=this.generateId(10);this.selectBackgroundImage(i);)i=this.generateId(10);var s={id:i,path:n,storedUndo:[],storedElement:[]};this.images.push(s),o&&this.setBackgroundImage(s),e&&e({id:s.id,path:s.path}),this.$el.trigger("annotate-image-added",[s.id,s.path])},initBackgroundImages:function(){var o=this;t.each(o.options.images,function(t,e){var i=!1;0===t&&(i=!0),o.pushImage(e,i)})},selectBackgroundImage:function(o){return t.grep(this.images,function(t){return t.id===o})[0]},setBackgroundImage:function(t){var o=this;o.$textbox.is(":visible")&&o.pushText();var e=o.selectBackgroundImage(o.selectedImage);e&&(e.storedElement=o.storedElement,e.storedUndo=o.storedUndo),o.img=new Image,o.img.src=t.path,o.img.onload=function(){void 0!==(o.options.width&&o.options.height)||0!==(o.options.width&&o.options.height)?(o.currentWidth=o.options.width,o.currentHeight=o.options.height,o.selectImageSize.width=o.options.width,o.selectImageSize.height=o.options.height):(o.currentWidth=this.width,o.currentHeight=this.height,o.selectImageSize.width=this.width,o.selectImageSize.height=this.height),o.baseCanvas.width=o.drawingCanvas.width=o.currentWidth,o.baseCanvas.height=o.drawingCanvas.height=o.currentHeight,o.baseContext.drawImage(o.img,0,0,o.currentWidth,o.currentHeight),o.$el.css({height:o.currentHeight,width:o.currentWidth}),o.storedElement=t.storedElement,o.storedUndo=t.storedUndo,o.selectedImage=t.id,o.checkUndoRedo(),o.clear(),o.redraw(),o.annotateresize()}},checkUndoRedo:function(){0===this.storedUndo.length?(this.$tool.children(".annotate-redo").attr("disabled",!0),t("#redoaction").addClass("hcmsButtonOff"),t("#redoaction").removeClass("hcmsButton")):(this.$tool.children(".annotate-redo").attr("disabled",!1),t("#redoaction").addClass("hcmsButton"),t("#redoaction").removeClass("hcmsButtonOff")),0===this.storedElement.length?(this.$tool.children(".annotate-undo").attr("disabled",!0),t("#undoaction").addClass("hcmsButtonOff"),t("#undoaction").removeClass("hcmsButton")):(this.$tool.children(".annotate-undo").attr("disabled",!1),t("#undoaction").addClass("hcmsButton"),t("#undoaction").removeClass("hcmsButtonOff"))},undoaction:function(t){t.preventDefault();this.storedUndo.push(this.storedElement[this.storedElement.length-1]),this.storedElement.pop(),this.checkUndoRedo(),this.clear(),this.redraw()},redoaction:function(t){t.preventDefault();this.storedElement.push(this.storedUndo[this.storedUndo.length-1]),this.storedUndo.pop(),this.checkUndoRedo(),this.clear(),this.redraw()},redraw:function(){this.baseCanvas.width=this.baseCanvas.width,1!=this.zoomfactor?(hideFaceOnImage(),clickevent="annotate"):showFaceOnImage();var o=this.options.width*this.zoomfactor,e=this.options.height*this.zoomfactor;if(this.currentWidth=o,this.currentHeight=e,this.baseCanvas.width=this.drawingCanvas.width=o,this.baseCanvas.height=this.drawingCanvas.height=e,t("#annotationFrame").width(o),t("#annotationFrame").height(e+4),t("#annotation").width(o),t("#annotation").height(e),this.drawingContext.scale(this.zoomfactor,this.zoomfactor),this.options.images&&(this.baseContext.drawImage(this.img,0,0,this.currentWidth,this.currentHeight),this.baseContext.scale(this.zoomfactor,this.zoomfactor)),this.storedElement.length>0)for(var i=0;i<this.storedElement.length;i++){var n=this.storedElement[i];switch(n.type){case"rectangle":this.drawRectangle(this.baseContext,n.fromx,n.fromy,n.tox,n.toy);break;case"arrow":this.drawArrow(this.baseContext,n.fromx,n.fromy,n.tox,n.toy);break;case"pen":for(var s=0;s<n.points.length-1;s++){var a=n.points[s][0],h=n.points[s][1],l=n.points[s+1][0],r=n.points[s+1][1];this.drawPen(this.baseContext,a,h,l,r)}break;case"text":this.drawText(this.baseContext,n.text,n.fromx,n.fromy,n.maxwidth);break;case"circle":this.drawCircle(this.baseContext,n.fromx,n.fromy,n.tox,n.toy)}}},clear:function(){this.drawingCanvas.width=this.drawingCanvas.width},drawRectangle:function(t,o,e,i,n){t.beginPath(),t.rect(o,e,i,n),t.fillStyle="transparent",t.fill(),t.lineWidth=this.linewidth,t.strokeStyle=this.options.color,t.stroke()},drawCircle:function(t,o,e,i,n){var s=.5*(i-o),a=.5*(n-e),h=o+s,l=e+a,r=.05,d=2*Math.PI-.05;for(t.beginPath(),t.moveTo(h+s*Math.cos(0),l+a*Math.sin(0));r<d;r+=.05)t.lineTo(h+s*Math.cos(r),l+a*Math.sin(r));t.lineWidth=this.linewidth,t.strokeStyle=this.options.color,t.closePath(),t.stroke()},drawArrow:function(t,o,e,i,n){var s=Math.atan2(n-e,i-o);t.beginPath(),t.lineWidth=this.linewidth,t.moveTo(o,e),t.lineTo(i,n),t.moveTo(i-5*this.linewidth*Math.cos(s+Math.PI/6),n-5*this.linewidth*Math.sin(s+Math.PI/6)),t.lineTo(i,n),t.lineTo(i-5*this.linewidth*Math.cos(s-Math.PI/6),n-5*this.linewidth*Math.sin(s-Math.PI/6)),t.strokeStyle=this.options.color,t.stroke()},drawPen:function(t,o,e,i,n){t.lineWidth=this.linewidth,t.moveTo(o,e),t.lineTo(i,n),t.strokeStyle=this.options.color,t.stroke()},wrapText:function(t,o,e,i,n,s){for(var a=o.split("\n"),h=0;h<a.length;h++){for(var l=a[h].split(" "),r="",d=0;d<l.length;d++){var c=r+l[d]+" ";t.measureText(c).width>n&&d>0?(t.fillText(r,e,i),r=l[d]+" ",i+=s):r=c}t.fillText(r,e,i+h*s)}},drawText:function(t,o,e,i,n){t.font=this.fontsize+" sans-serif",t.textBaseline="top",t.fillStyle=this.options.color,this.wrapText(t,o,e+3,i+4,n,25)},pushText:function(){var t=this.$textbox.val();this.$textbox.val("").hide(),t&&(this.storedElement.push({type:"text",text:t,fromx:this.fromx,fromy:this.fromy,maxwidth:this.tox}),this.storedUndo.length>0&&(this.storedUndo=[])),this.checkUndoRedo(),this.redraw()},selectTool:function(t){null!=t.data("tool")?clickevent="annotate":clickevent="";this.options.type=t.data("tool"),this.$textbox.is(":visible")&&this.pushText()},annotatestart:function(t){this.clicked=!0;var o=this.$el.offset();if(this.$textbox.is(":visible")){var e=this.$textbox.val();this.$textbox.val("").hide(),""!==e&&(this.tox||(this.tox=200),this.storedElement.push({type:"text",text:e,fromx:(this.fromxText-o.left)*this.compensationWidthRate,fromy:(this.fromyText-o.top)*this.compensationWidthRate,maxwidth:this.tox}),this.storedUndo.length>0&&(this.storedUndo=[])),this.checkUndoRedo(),this.redraw(),this.clear()}this.tox=null,this.toy=null,this.points=[];var i=t.pageX||t.originalEvent.touches[0].pageX,n=t.pageY||t.originalEvent.touches[0].pageY;this.fromx=(i-o.left)*this.compensationWidthRate,this.fromy=(n-o.top)*this.compensationWidthRate,this.fromxText=i,this.fromyText=n,"text"===this.options.type&&this.$textbox.css({left:this.fromxText+2,top:this.fromyText,width:0,height:0}).show(),"pen"===this.options.type&&this.points.push([this.fromx,this.fromy])},annotatestop:function(){if(this.clicked=!1,annotatestatus=!0,null!==this.toy&&null!==this.tox){switch(this.options.type){case"rectangle":this.storedElement.push({type:"rectangle",fromx:this.fromx,fromy:this.fromy,tox:this.tox,toy:this.toy});break;case"circle":this.storedElement.push({type:"circle",fromx:this.fromx,fromy:this.fromy,tox:this.tox,toy:this.toy});break;case"arrow":this.storedElement.push({type:"arrow",fromx:this.fromx,fromy:this.fromy,tox:this.tox,toy:this.toy});break;case"text":this.$textbox.css({left:this.fromxText+2,top:this.fromyText,width:this.tox-12,height:this.toy});break;case"pen":this.storedElement.push({type:"pen",points:this.points});for(var t=0;t<this.points.length-1;t++)this.fromx=this.points[t][0],this.fromy=this.points[t][1],this.tox=this.points[t+1][0],this.toy=this.points[t+1][1],this.drawPen(this.baseContext,this.fromx,this.fromy,this.tox,this.toy);this.points=[],this.penmouse=1}this.storedUndo.length>0&&(this.storedUndo=[]),this.checkUndoRedo(),this.redraw()}else"text"===this.options.type&&this.$textbox.css({left:this.fromxText+2,top:this.fromyText,width:200,height:25})},annotateleave:function(t){this.clicked&&this.annotatestop(t)},annotatemove:function(t){if(this.options.type&&t.preventDefault(),this.clicked){var o=this.$el.offset(),e=t.pageX||t.originalEvent.touches[0].pageX,i=t.pageY||t.originalEvent.touches[0].pageY;switch(this.options.type){case"rectangle":this.clear(),this.tox=(e-o.left)*this.compensationWidthRate-this.fromx,this.toy=(i-o.top)*this.compensationWidthRate-this.fromy,this.drawRectangle(this.drawingContext,this.fromx*this.zoomfactor,this.fromy*this.zoomfactor,this.tox*this.zoomfactor,this.toy*this.zoomfactor);break;case"arrow":this.clear(),this.tox=(e-o.left)*this.compensationWidthRate,this.toy=(i-o.top)*this.compensationWidthRate,this.drawArrow(this.drawingContext,this.fromx*this.zoomfactor,this.fromy*this.zoomfactor,this.tox*this.zoomfactor,this.toy*this.zoomfactor);break;case"pen":this.tox=(e-o.left)*this.compensationWidthRate,this.toy=(i-o.top)*this.compensationWidthRate,this.fromx=this.points[this.points.length-1][0],this.fromy=this.points[this.points.length-1][1],this.points.push([this.tox,this.toy]);var n=this.zoomfactor;this.penmouse>0&&(n=1),this.drawPen(this.drawingContext,this.fromx*n,this.fromy*n,this.tox*n,this.toy*n);break;case"text":this.clear(),this.tox=(e-this.fromxText)*this.compensationWidthRate,this.toy=(i-this.fromyText)*this.compensationWidthRate,this.$textbox.css({left:this.fromxText*this.zoomfactor+2,top:this.fromyText*this.zoomfactor,width:this.tox*this.zoomfactor-12,height:this.toy*this.zoomfactor});break;case"circle":this.clear(),this.tox=(e-o.left)*this.compensationWidthRate,this.toy=(i-o.top)*this.compensationWidthRate,this.drawCircle(this.drawingContext,this.fromx*this.zoomfactor,this.fromy*this.zoomfactor,this.tox*this.zoomfactor,this.toy*this.zoomfactor)}}},annotateresize:function(){var t=this.$el.width(),o=this.compensationWidthRate;this.compensationWidthRate=this.selectImageSize.width/t,this.compensationWidthRate<1&&(this.compensationWidthRate=1),this.linewidth=this.options.linewidth*this.compensationWidthRate*this.zoomfactor,this.fontsize=String(parseInt(this.options.fontsize.split("px")[0],10)*this.compensationWidthRate*this.zoomfactor)+"px",o!==this.compensationWidthRate&&(this.redraw(),this.clear())},zoomaction:function(t){if(t>0){this.zoomfactor=t,this.clear(),this.redraw(),this.annotateresize(),this.penmouse=0}},flatten:function(){var o=this.zoomfactor;1!=o&&(this.zoomfactor=1,this.redraw());var e=this.$el.find("canvas"),i=document.createElement("canvas"),n=null;this.$textbox.is(":visible")&&this.pushText();for(var s=0;s<e.length;++s)0===s&&(i.width=e[s].width,i.height=e[s].height,n=i.getContext("2d")),n.drawImage(e[s],0,0);var a=i.toDataURL("image/jpeg",.95);t("#mediadata").val(a),o!=this.zoomfactor&&(this.zoomfactor=o,this.redraw())},destroy:function(){t(document).off(this.options.selectEvent,".annotate-image-select"),this.$tool.remove(),this.$textbox.remove(),this.$el.children("canvas").remove(),this.$el.removeData("annotate")},exportImage:function(o,e){this.$textbox.is(":visible")&&this.pushText();o=t.extend({},{type:"image/jpeg",quality:.95},o);var i=this.baseCanvas.toDataURL(o.type,o.quality);e&&e(i)}},t.fn.annotate=function(e,i,n){var s=t(this).data("annotate");if("destroy"===e){if(!s)throw new Error("No annotate initialized for: #"+t(this).attr("id"));s.destroy()}else if("push"===e){if(!s)throw new Error("No annotate initialized for: #"+t(this).attr("id"));s.pushImage(i,!0,n)}else if("fill"===e){if(!s)throw new Error("No annotate initialized for: #"+t(this).attr("id"));s.addElements(i,!0,n)}else if("export"===e){if(!s)throw new Error("No annotate initialized for: #"+t(this).attr("id"));s.exportImage(i,n)}else if("flatten"===e){if(!t(this).data("annotate"))throw"No annotate initialized for: #"+t(this).attr("id");t(this).data("annotate").flatten()}else{var a=t.extend({},t.fn.annotate.defaults,e),h=new o(t(this),a);t(this).data("annotate",h)}},t.fn.annotate.defaults={width:null,height:null,images:[],color:"red",type:"null",linewidth:2,fontsize:"20px",bootstrap:!1,position:"top",idAttribute:"id",selectEvent:"change",unselectTool:!1}}(jQuery);