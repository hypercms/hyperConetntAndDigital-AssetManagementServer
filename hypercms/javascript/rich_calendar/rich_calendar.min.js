RichCalendar=function(e,t){this.value="",this.format="%Y-%m-%d",this.start_week_day=1,this.iframe_obj=null,this.lib_path="rich_calendar/",this.target_obj=e,this.show_time=t,this.user_onchange_handler=null,this.user_onclose_handler=null,this.user_onautoclose_handler=null,this.default_lang="en",this.language="en",this.date=new Date,this.skin="",this.auto_close=!0,this.value_el=null,this.position=null},RichCalendar.is_ie=/msie/i.test(navigator.userAgent)&&!/opera/i.test(navigator.userAgent),RichCalendar.get_iframe_styles=function(){var e,t,a=document.styleSheets,i=a.length,s="";for(e=0;e<i;e++)if(RichCalendar.is_ie){if(/rich_calendar.css$/.test(a[e].href)){s+=a[e].cssText;break}}else{var r=null;try{r=RichCalendar.is_ie?a[e].rules:a[e].cssRules}catch(e){continue}if(null!=r)for(rules_num=r.length,t=0;t<rules_num;t++){var n=r[t].selectorText;/rc_iframe/.test(n)&&(s+=r[t].cssText)}}return s},RichCalendar.attach_event=function(e,t,a){e.addEventListener?e.addEventListener(t,a,!1):e.attachEvent&&e.attachEvent("on"+t,a)},RichCalendar.detach_event=function(e,t,a){e.removeEventListener?e.removeEventListener(t,a,!1):e.detachEvent&&e.detachEvent("on"+t,a)},RichCalendar.attach_events=function(e){RichCalendar.attach_event(e,"click",RichCalendar.onclick),RichCalendar.attach_event(e,"mouseover",RichCalendar.onmouseover),RichCalendar.attach_event(e,"mouseout",RichCalendar.onmouseout)},RichCalendar.detach_events=function(e){RichCalendar.detach_event(e,"click",RichCalendar.onclick),RichCalendar.detach_event(e,"mouseover",RichCalendar.onmouseover),RichCalendar.detach_event(e,"mouseout",RichCalendar.onmouseout)},RichCalendar.onclick=function(e){RichCalendar.get_event(e);var t=RichCalendar.get_target_object(e);if(t){var a=t.calendar,i=a.date.getFullYear(),s=a.date.getMonth(),r=a.date.getDate();switch(t.rc_object_code){case"day":a.date.setDate(t.day_num);break;case"prev_year":a.date.setDate(1),a.date.setFullYear(i-1),r>(n=RichCalendar.get_month_days(a.date))?a.date.setDate(n):a.date.setDate(r),a.show_date();break;case"prev_month":a.date.setDate(1),a.date.setMonth(s-1),r>(n=RichCalendar.get_month_days(a.date))?a.date.setDate(n):a.date.setDate(r),a.show_date();break;case"next_month":a.date.setDate(1),a.date.setMonth(s+1),r>(n=RichCalendar.get_month_days(a.date))?a.date.setDate(n):a.date.setDate(r),a.show_date();break;case"next_year":var n;a.date.setDate(1),a.date.setFullYear(i+1),r>(n=RichCalendar.get_month_days(a.date))?a.date.setDate(n):a.date.setDate(r),a.show_date();break;case"today":var o=new Date;o.setHours(a.date.getHours()),o.setMinutes(a.date.getMinutes()),o.setSeconds(a.date.getSeconds()),a.date=o,a.show_date();break;case"clear":a.value_el&&(a.value_el.value="");break;case"close":a.onclose_handler();break;case"week_day":a.start_week_day=t.week_day_num,a.show_date()}"week_day"!=t.rc_object_code&&a.onchange_handler(t.rc_object_code),RichCalendar.hide_auto_close(a)}},RichCalendar.onmouseover=function(e){RichCalendar.get_event(e);var t=RichCalendar.get_target_object(e);if(t){var a=t.calendar;a.date.getFullYear(),a.date.getMonth(),a.date.getDate();switch(t.rc_object_code){case"day":var i=new Date(a.date);i.setDate(t.day_num),a.set_footer_text(a.get_formatted_date(a.text("footerDateFormat"),i)),RichCalendar.add_class(t,"rc_highlight"),RichCalendar.add_class(t.parentNode,"rc_highlight");break;case"clear":case"today":case"close":case"prev_year":case"prev_month":case"next_month":case"next_year":a.set_footer_text(a.text(t.rc_object_code));break;case"week_day":if(t.week_day_num!=a.start_week_day){var s=a.text("dayNames")[t.week_day_num];r=(r=a.text("make_first")).replace("%s",s)}else var r=a.text("footerDefaultText");a.set_footer_text(r);break;default:a.set_footer_text(a.text("footerDefaultText"))}}},RichCalendar.onmouseout=function(e){RichCalendar.get_event(e);var t=RichCalendar.get_target_object(e);if(t){var a=t.calendar;a.set_footer_text(a.text("footerDefaultText")),RichCalendar.remove_class(t,"rc_highlight"),RichCalendar.remove_class(t.parentNode,"rc_highlight")}},RichCalendar.document_onmousedown=function(e){RichCalendar.get_event(e);var t=RichCalendar.get_target_object(e);if(t){for(var a=t,i=null;a;){if(a.className&&a.className.match(/^rc_iframe_body/)&&"BODY"==a.tagName.toUpperCase()){i=a.calendar;break}a=a.parentNode}RichCalendar.hide_auto_close(i)}},RichCalendar.hide_auto_close=function(e){var t,a=[];for(t=0;t<RichCalendar.active_calendars.length;t++){var i=RichCalendar.active_calendars[t];i.auto_close&&i!=e?(i.hide(),i.user_onautoclose_handler&&i.user_onautoclose_handler(this)):a[a.length]=i}RichCalendar.active_calendars=a},RichCalendar.make_inactive=function(e){var t,a=[];for(t=0;t<RichCalendar.active_calendars.length;t++){var i=RichCalendar.active_calendars[t];i!=e&&(a[a.length]=i)}RichCalendar.active_calendars=a},RichCalendar.get_event=function(e){return e||window.event},RichCalendar.get_target_object=function(e){return e.target?e.target:e.srcElement?e.srcElement:window.event.srcElement},RichCalendar.skin_suffix=function(e){return""!=e?"_"+e:""},RichCalendar.get_month_days=function(e,t){var a=e.getFullYear();return t&&((t=parseInt(t))<=0||t>11)&&(t=null),t||(t=e.getMonth()),1==t&&RichCalendar.is_leap_year(a)?29:RichCalendar.month_days[t]},RichCalendar.is_leap_year=function(e){return e%4==0&&e%100!=0||e%400==0},RichCalendar.get_day_of_year=function(e){var t=new Date(e.getFullYear(),e.getMonth(),e.getDate(),0,0,0),a=new Date(e.getFullYear(),0,0,0,0,0);return Math.floor((t-a)/864e5)},RichCalendar.add_class=function(e,t){RichCalendar.remove_class(e,t),e.className+=" "+t},RichCalendar.remove_class=function(e,t){if(e&&e.className){var a,i=[],s=String(e.className).split(" ");for(a=0;a<s.length;a++)""!=s[a]&&s[a]!=t&&(i[i.length]=s[a]);e.className=i.join(" ")}},RichCalendar.get_obj_pos=function(e,t){var a=Array(0,0);if(!e)return a;for(var i=e;e&&t!=e;)a[0]+=e.offsetLeft,a[1]+=e.offsetTop,e!=i&&(a[0]+=parseInt(RichCalendar.get_style(e,"borderTopWidth"),10)||0,a[1]+=parseInt(RichCalendar.get_style(e,"borderLeftWidth"),10)||0),e=e.offsetParent;for(e=i;e&&t!=e&&"body"!=e.tagName.toLowerCase();)a[0]-=e.scrollLeft,a[1]-=e.scrollTop,e=e.parentNode;return a},RichCalendar.get_style=function(e,t){var a,i=document.defaultView;return i&&i.getComputedStyle?i.getComputedStyle(e,"")[t]:(a=e.currentStyle)?a[t]:(a=e.style[t])?a:void 0},RichCalendar.rc_lang_data=[],RichCalendar.month_days=[31,28,31,30,31,30,31,31,30,31,30,31],RichCalendar.active_calendars=[],RichCalendar.handlert_set=!1,RichCalendar.prototype.show=function(e,t,a,i){if(this.value_el||(this.value_el=a),this.position=i,this.iframe_obj=document.createElement("IFRAME"),this.iframe_obj.className="rc_calendar"+RichCalendar.skin_suffix(this.skin),this.iframe_obj.setAttribute("scrolling","no"),this.iframe_obj.setAttribute("src","javascript:false;"),this.iframe_obj.calendar=this,this.is_relative_position(i))switch(i){case"before":a.parentNode&&a.parentNode.insertBefore(this.iframe_obj,a);break;case"after":a.parentNode&&a.parentNode.insertBefore(this.iframe_obj,a.nextSibling);break;case"child":default:a.appendChild(this.iframe_obj),this.position="child"}else{this.iframe_obj.style.position="absolute";parseInt(e),parseInt(t);"number"==typeof e&&"number"==typeof t&&(this.iframe_obj.style.left=e+"px",this.iframe_obj.style.top=t+"px"),this.iframe_obj.style.border="1px solid #000000",this.iframe_obj.value=this.value,document.body.appendChild(this.iframe_obj)}var s,r='<html><head><style type="text/css">'+RichCalendar.get_iframe_styles()+'</style></head><body class="rc_iframe_body'+RichCalendar.skin_suffix(this.skin)+'" id="rc_body"></body></html>';for(this.iframe_doc=this.iframe_obj.contentWindow.document,this.iframe_doc.open(),this.iframe_doc.write(r),this.iframe_doc.close(),RichCalendar.attach_event(this.iframe_doc,"mousedown",RichCalendar.document_onmousedown),this.body_obj=this.iframe_doc.getElementById("rc_body"),this.body_obj.calendar=this,this.table_obj=this.iframe_doc.createElement("TABLE"),this.table_obj.className="rc_table",this.table_obj.setAttribute("id","rc_iframe_table"),this.table_obj.cellSpacing=0,this.table_obj.cellPadding=0,this.table_obj.calendar=this,this.head_tr=this.table_obj.insertRow(0),this.head_tr.className="rc_head_tr",this.clear_td=this.head_tr.insertCell(0),this.clear_td.innerHTML="c",this.clear_td.rc_object_code="clear",this.clear_td.calendar=this,RichCalendar.attach_events(this.clear_td),this.head_td=this.head_tr.insertCell(1),this.head_td.colSpan=5,this.close_td=this.head_tr.insertCell(2),this.close_td.innerHTML="x",this.close_td.rc_object_code="close",this.close_td.calendar=this,RichCalendar.attach_events(this.close_td),this.nav_tr=this.table_obj.insertRow(1),this.nav_tr.className="rc_nav_tr",this.prev_year_td=this.nav_tr.insertCell(0),this.prev_year_td.innerHTML="&#x00ab;",this.prev_year_td.rc_object_code="prev_year",this.prev_year_td.calendar=this,RichCalendar.attach_events(this.prev_year_td),this.prev_month_td=this.nav_tr.insertCell(1),this.prev_month_td.innerHTML="&#x2039;",this.prev_month_td.rc_object_code="prev_month",this.prev_month_td.calendar=this,RichCalendar.attach_events(this.prev_month_td),this.today_td=this.nav_tr.insertCell(2),this.today_td.colSpan=3,this.today_td.innerHTML=this.text("today"),this.today_td.rc_object_code="today",this.today_td.calendar=this,RichCalendar.attach_events(this.today_td),this.next_month_td=this.nav_tr.insertCell(3),this.next_month_td.innerHTML="&#x203a;",this.next_month_td.rc_object_code="next_month",this.next_month_td.calendar=this,RichCalendar.attach_events(this.next_month_td),this.next_year_td=this.nav_tr.insertCell(4),this.next_year_td.innerHTML="&#x00bb;",this.next_year_td.rc_object_code="next_year",this.next_year_td.calendar=this,RichCalendar.attach_events(this.next_year_td),this.wd_tr=this.table_obj.insertRow(2),this.wd_tr.className="rc_wd_tr",s=0;s<7;s++){(o=this.wd_tr.insertCell(s)).rc_object_code="week_day",o.calendar=this,RichCalendar.attach_events(o)}var n,o;for(this.cal_tr=[],n=0;n<4;n++)this.create_cal_row(n);this.show_time&&(this.time_tr=this.table_obj.insertRow(7),this.time_tr.className="rc_time_tr",(o=this.time_tr.insertCell(0)).colSpan=2,o.innerHTML=this.text("time")+":",(o=this.time_tr.insertCell(1)).colSpan=3,this.hours_obj=this.createElement("INPUT",o),this.hours_obj.className="rc_hours",this.hours_obj.setAttribute("size",1),this.hours_obj.setAttribute("maxlength",2),this.colon_span=this.createElement("SPAN",o),this.colon_span.className="rc_colon_span",this.colon_span.innerHTML="&nbsp;:&nbsp;",this.mins_obj=this.createElement("INPUT",o),this.mins_obj.className="rc_mins",this.mins_obj.setAttribute("size",1),this.mins_obj.setAttribute("maxlength",2),(o=this.time_tr.insertCell(2)).colSpan=2,o.innerHTML="&nbsp;");this.footer_tr=this.table_obj.insertRow(7+(this.show_time?1:0)),this.footer_tr.className="rc_footer_tr",this.footer_td=this.footer_tr.insertCell(0),this.footer_td.colSpan=7,this.footer_td.innerHTML=this.text("footerDefaultText"),this.body_obj.appendChild(this.table_obj),this.size_div=document.createElement("DIV"),this.size_div.className=this.body_obj.className,this.size_div.style.position="absolute",this.size_div.style.left="-1000px",this.size_div.style.top="-1000px",document.body.appendChild(this.size_div),this.show_date(),RichCalendar.handlers_set||(RichCalendar.attach_event(document,"mousedown",RichCalendar.document_onmousedown),RichCalendar.handlers_set=!0),RichCalendar.active_calendars[RichCalendar.active_calendars.length]=this},RichCalendar.prototype.hide=function(){this.iframe_obj&&(this.iframe_obj.parentNode.removeChild(this.iframe_obj),this.iframe_obj=null),RichCalendar.make_inactive(this)},RichCalendar.prototype.show_at_element=function(e,t){if("object"==typeof e&&e)if(this.is_relative_position(t))this.show(null,null,e,t);else{RichCalendar.get_obj_pos(e);this.show(-1e3,-1e3,e,t)}},RichCalendar.prototype.fix_position=function(e){var t=this.position;if(!this.is_relative_position(t)){e||(e=this.value_el);var a=String(t).split("-");if(2==a.length){var i=RichCalendar.get_obj_pos(e),s=i[0],r=i[1]+e.offsetHeight,n=parseInt(this.iframe_obj.style.borderWidth),o=parseInt(this.iframe_obj.width)+2*n,h=parseInt(this.iframe_obj.height)+2*n;switch(a[0]){case"left":s-=o;break;case"center":s+=(e.offsetWidth-o)/2;break;case"right":s+=e.offsetWidth;break;case"adj_right":s+=e.offsetWidth-o}switch(a[1]){case"top":r-=e.offsetHeight+h;break;case"center":r+=(e.offsetHeight-h)/2-e.offsetHeight;break;case"bottom":break;case"adj_bottom":r-=h}this.iframe_obj.style.left=s+"px",this.iframe_obj.style.top=r+"px",this.iframe_obj.style.visibility="visible"}}},RichCalendar.prototype.is_relative_position=function(e){switch(e){case"before":case"after":case"child":return!0;default:return!1}},RichCalendar.prototype.createElement=function(e,t){var a=this.iframe_doc.createElement(e);return t&&t.appendChild(a),a},RichCalendar.prototype.text=function(e,t){return void 0===t&&(t=this.language),void 0!==RichCalendar.rc_lang_data[t]?void 0!==RichCalendar.rc_lang_data[t][e]?RichCalendar.rc_lang_data[t][e]:"":void 0!==RichCalendar.rc_lang_data[this.default_language][e]?RichCalendar.rc_lang_data[this.default_language][e]:""},RichCalendar.prototype.show_date=function(){var e,t=this.get_weekend_days(),a=this.text("dayNamesShort");for(e=0;e<7;e++){var i=(e+this.start_week_day)%7,s=this.wd_tr.cells[e];s.innerHTML=a[i],void 0!==t[i]?s.className="rc_weekend_head":s.className="",s.week_day_num=i}var r=RichCalendar.get_month_days(this.date),n=new Date(this.date);n.setDate(1);var o,h,c=(n.getDay()+7-this.start_week_day)%7+1,_=this.date.getFullYear(),d=this.date.getMonth(),l=this.date.getDate(),m=new Date,f=m.getFullYear(),u=m.getMonth(),b=m.getDate(),v=this.text("monthNames");this.head_td.innerHTML=v[d]+", "+_;var g,p=0;for(o=0;o<6;o++)if(p!=r)for(h=0;h<7;h++){this.cal_tr[o]||this.create_cal_row(o);var C=this.cal_tr[o].cells[h];if(C.className="",RichCalendar.detach_events(C),0==o&&h+1<c||p==r)var y="&nbsp;";else{var R=p+1;y=R;p++,C.rc_object_code="day",C.day_num=R,C.calendar=this,RichCalendar.attach_events(C),l==R&&RichCalendar.add_class(C,"rc_current"),R==b&&d==u&&_==f&&RichCalendar.add_class(C,"rc_today"),void 0!==t[i=(h+this.start_week_day)%7]?RichCalendar.add_class(C,"rc_weekend_day"):RichCalendar.remove_class(C,"rc_weekend_day")}C.innerHTML=y,p==r&&(g=o)}else this.cal_tr[g+1]&&(this.cal_tr[g+1].parentNode.removeChild(this.cal_tr[g+1]),this.cal_tr[o]=null);if(this.show_time&&this.hours_obj&&this.mins_obj){var j=this.date.getHours();j<10&&(j="0"+j);var w=this.date.getMinutes();w<10&&(w="0"+w),this.hours_obj.value=j,this.mins_obj.value=w}var x=this;window.setTimeout(function(){x.fit_to_content()},1),window.setTimeout(function(){x.fix_position()},5)},RichCalendar.prototype.fit_to_content=function(){try{var e=this.iframe_doc.getElementById("rc_iframe_table");this.iframe_obj.width=e.offsetWidth,this.iframe_obj.height=e.offsetHeight,parseInt(this.iframe_obj.width)&&parseInt(this.iframe_obj.height)||(this.size_div.innerHTML=this.body_obj.innerHTML,this.iframe_obj.width=this.size_div.offsetWidth,this.iframe_obj.height=this.size_div.offsetHeight)}catch(e){}},RichCalendar.prototype.create_cal_row=function(e){var t,a=this.table_obj.insertRow(3+e);for(a.className="rc_cal_tr",t=0;t<7;t++)a.insertCell(t);return this.cal_tr[e]=a,a},RichCalendar.prototype.change_skin=function(e){if(this.iframe_obj){var t=RichCalendar.skin_suffix(e);this.iframe_obj.className="rc_calendar"+t,this.body_obj.className="rc_iframe_body"+t,this.skin=e}},RichCalendar.prototype.get_formatted_date=function(e,t){if(t||(t=this.date),e||(e=this.get_date_format()),this.show_time&&this.hours_obj&&this.mins_obj){this.date.setHours(this.hours_obj.value);var a=this.date.setMinutes(this.mins_obj.value)}var i=t.getFullYear(),s=t.getMonth(),r=t.getDate(),n=t.getDay(),o=t.getHours(),h=(a=t.getMinutes(),t.getSeconds()),c=this.text("monthNamesShort"),_=this.text("monthNames"),d=this.text("dayNamesShort"),l=this.text("dayNames"),m=o<12,f=o>12?o-12:0==o?12:o,u=[];u["%a"]=m?"am":"pm",u["%A"]=m?"AM":"PM",u["%d"]=r<10?"0"+r:r,u["%D"]=d[n],u["%F"]=_[s],u["%h"]=f<10?"0"+f:f,u["%H"]=o<10?"0"+o:o,u["%g"]=f,u["%G"]=o,u["%i"]=a<10?"0"+a:a,u["%j"]=r,u["%l"]=l[n],u["%L"]=RichCalendar.is_leap_year(i)?1:0,u["%m"]=s<9?"0"+(s+1):s+1,u["%n"]=s+1,u["%M"]=c[s],u["%s"]=h<10?"0"+h:h,u["%t"]=RichCalendar.get_month_days(t),u["%w"]=n,u["%Y"]=i,u["%y"]=String(i).substr(2,2),u["%z"]=RichCalendar.get_day_of_year(t);var b,v=String(e).match(/%./g),g=e;for(b=0;b<v.length;b++){var p=u[v[b]];if(void 0!==p){var C=new RegExp(v[b],"g");g=g.replace(C,p)}}return g},RichCalendar.prototype.set_footer_text=function(e){this.footer_td&&(this.footer_td.innerHTML=e)},RichCalendar.prototype.get_weekend_days=function(){var e,t=this.text("weekend").split(","),a=[];for(e=0;e<t.length;e++)a[t[e]]=!0;return a},RichCalendar.prototype.onclose_handler=function(){this.user_onclose_handler?this.user_onclose_handler(this):this.hide()},RichCalendar.prototype.onchange_handler=function(e){this.user_onchange_handler?this.user_onchange_handler(this,e):"day"==e&&(this.value_el&&(this.value_el.value=this.get_formatted_date()),this.auto_close&&this.hide())},RichCalendar.prototype.get_date_format=function(){var e=this.text("dateFormat"),t=e||this.format;return this.show_time&&(t+=" %H:%i"),t},RichCalendar.prototype.parse_date=function(e,t){if(void 0!==e){t||(t=this.get_date_format());var a=new Date,i=0,s=-1,r=0,n=0,o=0,h=0,c=this.text("monthNames"),_=this.text("monthNamesShort"),d=this.text("monthNames","en"),l=this.text("monthNamesShort","en");for(u=0;u<c.length;u++){var m=new RegExp(c[u],"gi");e=e.replace(m,d[u])}for(u=0;u<_.length;u++){m=new RegExp(_[u],"gi");e=e.replace(m,l[u])}var f,u,b=String(e).split(/\W+/g),v=String(t).match(/%./g);for(f=0;f<v.length;f++)if(b[f])switch(v[f]){case"%a":case"%A":/am/i.test(b[f])&&n>=12?n-=12:/pm/i.test(b[f])&&n<12&&(n+=12);break;case"%d":case"%j":r=parseInt(Number(b[f]));break;case"%F":for(u=0;u<d.length;u++)if(d[u].toLowerCase()==b[f].toLowerCase()){s=u;break}break;case"%h":case"%H":case"%g":case"%G":n=parseInt(Number(b[f])),/am/i.test(b[f])&&n>=12?n-=12:/pm/i.test(b[f])&&n<12&&(n+=12);break;case"%i":o=parseInt(Number(b[f]));break;case"%m":case"%n":s=parseInt(Number(b[f]))-1;break;case"%M":for(u=0;u<l.length;u++)if(l[u].toLowerCase()==b[f].toLowerCase()){s=u;break}break;case"%s":h=parseInt(Number(b[f]));break;case"%Y":i=parseInt(Number(b[f]));break;case"%y":(i=parseInt(b[f]))<100&&(i+=i+(i>29?1900:2e3))}(isNaN(i)||i<=0)&&(i=a.getFullYear()),(isNaN(s)||s<0||s>11)&&(s=a.getMonth()),(isNaN(r)||r<=0||r>31)&&(r=a.getDate()),(isNaN(n)||n<0||n>23)&&(n=a.getHours()),(isNaN(o)||o<0||o>59)&&(o=a.getMinutes()),(isNaN(h)||h<0||h>59)&&(h=a.getSeconds()),this.date=new Date(i,s,r,n,o,h)}};