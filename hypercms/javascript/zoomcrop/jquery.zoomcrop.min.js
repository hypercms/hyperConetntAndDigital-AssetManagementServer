function ZoomCrop(t){this.settings=null,this.target=t,this.slider=null,this.dragcontainer=null,this.image=null,this.viewportRatio=1,this.imageRatio=1,this.imageSize={width:0,height:0},this.init=function(t){this.settings||(this.target.addClass("ZoomCrop-viewport"),this.slider=$('<div class="ZoomCrop-slider"></div>'),this.slider.appendTo(this.target),this.dragcontainer=$('<div class="ZoomCrop-dragcontainer"></div>'),this.dragcontainer.appendTo(this.target),this.slider.slider({value:100*t.initialZoom,slide:$.proxy(function(t,i){this._updateZoom(i.value)},this),stop:$.proxy(this._updated,this)})),0==t.realWidth&&(t.realWidth=this.target.width()),t.image&&this.loadImage(t.image),this.settings=t},this.loadImage=function(t){this.image=$("<img/>"),this.target.addClass("ZoomCrop-loading"),this.dragcontainer.find("img").remove();var i=this;this.image.attr("src",t).load(function(t){i.imageSize.width=this.width,i.imageSize.height=this.height,i.target.removeClass("ZoomCrop-loading"),i.image.appendTo(i.dragcontainer),i.image.draggable({containment:i.dragcontainer,stop:$.proxy(i._updated,i)}),i.viewportRatio=parseFloat(i.target.width())/parseFloat(i.settings.realWidth),i.imageRatio=parseFloat(i.imageSize.height)/parseFloat(i.imageSize.width),i.slider.slider("value",100*i.settings.initialZoom),i.ajustLayout(i.settings.initialZoom),i._updated(t,i.image)})},this._updateZoom=function(t){console.log("ZoomCrop","_updateZoom",t),this.ajustLayout(.01*parseFloat(t))},this.getZoom=function(){return.01*this.slider.slider("value")},this.setZoom=function(t){this.slider.slider("value",100*t),this.ajustLayout(t)},this.setPosition=function(t){this.setZoom(t.z),this.image.css({left:t.x,top:t.y})},this.ajustLayout=function(t){var i=this.image.position(),e=(.5*this.dragcontainer.width()-i.left)/this.image.width(),a=(.5*this.dragcontainer.height()-i.top)/this.image.height(),o=this.viewportRatio*this.imageSize.width,h=Math.min(this.viewportRatio<1?this.target.width():this.target.width()*this.viewportRatio,o),s=(o-h)*t,r=Math.round(h+s),n=Math.round(r*this.imageRatio);this.image.width(r),this.image.height(n);var d=Math.round(2*r-this.target.width()),g=Math.round(2*n-this.target.height());d<this.target.width()&&(d=this.target.width()),g<this.target.height()&&(g=this.target.height()),this.dragcontainer.width(d),this.dragcontainer.height(g),this.dragcontainer.css({left:Math.round(-.5*(d-this.target.width())),top:Math.round(-.5*(g-this.target.height()))});var l={width:0,height:0};l.left=Math.round(.5*d-e*r),l.top=Math.round(.5*g-a*n),l.left<0&&(l.left=0),l.top<0&&(l.top=0),l.left+r>d&&(l.left=d-r),l.top+n>g&&(l.top=g-n),this.image.css({left:l.left,top:l.top})},this._updated=function(t,i){var e=this.image.position(),a={width:Math.round(this.image.width()/this.viewportRatio),height:Math.round(this.image.height()/this.viewportRatio)},o={x1:Math.round((.5*this.dragcontainer.width()-.5*this.target.width()-e.left)/this.viewportRatio),y1:Math.round((.5*this.dragcontainer.height()-.5*this.target.height()-e.top)/this.viewportRatio),x2:0,y2:0,width:Math.round(this.target.width()/this.viewportRatio),height:Math.round(this.target.height()/this.viewportRatio)};o.x2=o.x1+o.width,o.y2=o.y1+o.height;var h={x:e.left,y:e.top,z:this.getZoom()};this.settings.updated.call(this,a,o,h)},this.unload=function(){this.target.find(".ZoomCrop-dragcontainer, .ZoomCrop-slider").remove(),this.target.removeClass("ZoomCrop-viewport"),this.target.data("ZoomCrop",null)}}jQuery.fn.ZoomCrop=function(t){var i=$.extend({},{initialZoom:0,image:null,realWidth:0,updated:function(t,i,e){}},t),e=arguments;return this.each(function(){var a=$(this),o=a.data("ZoomCrop");return o||(o=new ZoomCrop(a),a.data("ZoomCrop",o)),"function"==typeof o[t]?o[t].apply(o,Array.prototype.slice.call(e,1)):(o.init(i),o)})};