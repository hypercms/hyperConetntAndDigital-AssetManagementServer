var chat_state,chat_file,chat_instance=!1,chat_service="service/chat.php",chat_audio=new Audio("javascript/ding.mp3");function Chat(){this.update=updateChat,this.send=sendChat,this.getState=getStateOfChat,this.getInitState=getInitStateOfChat,this.inviteUser=inviteUserToChat,this.uninviteUsers=uninviteUsersOf,this.check=checkChat,this.open=openChat}function openChat(){if(document.getElementById("chatLayer"))var t=document.getElementById("chatLayer");else if(parent.document.getElementById("chatLayer"))t=parent.document.getElementById("chatLayer");else t=!1;document.getElementById("chat-area")&&(document.getElementById("chat-area").scrollTop=document.getElementById("chat-area").scrollHeight),t&&"0px"!=t.style.right&&(t.style.transition="0.3s",t.style.right="0px")}function getInitStateOfChat(){chat_instance||(chat_instance=!0,$.ajax({type:"POST",url:chat_service,data:{function:"getInitState",file:chat_file},dataType:"json",success:function(t){chat_state=t.state,chat_instance=!1}}))}function getStateOfChat(){chat_instance||(chat_instance=!0,$.ajax({type:"POST",url:chat_service,data:{function:"getState",file:chat_file},dataType:"json",success:function(t){chat_state=t.state,chat_instance=!1}}))}function updateChat(){chat_instance?setTimeout(updateChat,2e3):(chat_instance=!0,$.ajax({type:"POST",url:chat_service,data:{function:"update",state:chat_state,file:chat_file},dataType:"json",success:function(t){if(t.text){for(var e=!1,a=0;a<t.text.length;a++)$("#chat-area").append($("<p>"+t.text[a]+"</p>")),e=!0;1==e&&(openChat(),chat_audio.play())}chat_instance=!1,chat_state=t.state}}))}function sendChat(t,e){updateChat(),$.ajax({type:"POST",url:chat_service,data:{function:"send",message:t,nickname:e,file:chat_file},dataType:"json",success:function(t){updateChat()}})}function inviteUserToChat(t,e){updateChat(),$.ajax({type:"POST",url:chat_service,data:{function:"invite",message:t,nickname:e,file:chat_file},dataType:"json",success:function(t){updateChat()}})}function uninviteUsersOf(t){updateChat(),$.ajax({type:"POST",url:chat_service,data:{function:"uninvite",message:t,nickname:t,file:chat_file},dataType:"json",success:function(t){updateChat()}})}function checkChat(){chat_instance?setTimeout(checkChat,2e3):(chat_instance=!0,$.ajax({type:"POST",url:chat_service,data:{function:"check",state:chat_state,nickname:name,file:chat_file},dataType:"json",success:function(t){if(t.text){for(var e=!1,a=0;a<t.text.length;a++)$("#chat-area").append($("<p>"+t.text[a]+"</p>")),e=!0;1==e&&openChat()}chat_instance=!1,chat_state=t.state}}))}