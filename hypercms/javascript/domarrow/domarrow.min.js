var hcms_connection_topoffset=0;function hcms_connections_getNumberOrDef(e,t){return"number"!=typeof e||isNaN(e)?t:e}function hcms_connections_isVisible(e){return e&&"hidden"!==e.style.visibility}function hcms_connections_inside(e,t,n,o,s,i){return e<=s&&s<=n&&t<=i&&i<=o}function hcms_connections_intersectionPoint(e,t,n,o,s,i,c,r){var a=Math.min,l=Math.max,m=inside.bind(null,a(e,n),a(t,o),l(e,n),l(t,o));if(e<=s&&n<=s||t<=i&&o<=i||e>=c&&n>=c||t>=r&&o>=r||inside(s,i,c,r,e,t)&&inside(s,i,c,r,n,o))return null;var d=(o-t)/(n-e),h=d*(s-e)+t;if(i<h&&h<r&&m(s,h))return{x:s,y:h};if(i<(h=d*(c-e)+t)&&h<r&&m(c,h))return{x:c,y:h};var _=(i-t)/d+e;return s<_&&_<c&&m(_,i)?{x:_,y:i}:s<(_=(r-t)/d+e)&&_<c&&m(_,r)?{x:_,y:r}:null}function hcms_connections_adjustLine(e,t,n,o){var s=o&&o.color||"black",i=o&&o.width||2,c=parseFloat(e.style.top)?null:e.getBoundingClientRect(),r=parseFloat(t.style.top)?null:t.getBoundingClientRect(),a=c?window.scrollY+c.top:parseFloat(e.style.top),l=c?window.scrollX+c.left:parseFloat(e.style.left),m=r?window.scrollY+r.top:parseFloat(t.style.top),d=r?window.scrollX+r.left:parseFloat(t.style.left),h=c?c.width:parseFloat(e.style.width)||e.offsetWidth,_=c?c.height:parseFloat(e.style.height)||e.offsetHeight,f=r?r.width:parseFloat(t.style.width)||t.offsetWidth,u=r?r.height:parseFloat(t.style.height)||t.offsetHeight,y=a+_*hcms_connections_getNumberOrDef(o&&o.fromY,hcms_connections_getNumberOrDef(o,.5)),g=m+u*hcms_connections_getNumberOrDef(o&&o.toY,hcms_connections_getNumberOrDef(o,.5)),p=l+h*hcms_connections_getNumberOrDef(o&&o.fromX,hcms_connections_getNumberOrDef(o,.5)),b=d+f*hcms_connections_getNumberOrDef(o&&o.toX,hcms_connections_getNumberOrDef(o,.5)),w=Math.abs(g-y),v=Math.abs(b-p),N=Math.sqrt(w*w+v*v),x=180/Math.PI*Math.acos(v/N);if((y>=g||p>=b)&&(g>=y||b>=p)&&(x*=-1),o&&o.onlyVisible){var E=hcms_connections_intersectionPoint(p,y,b,g,l,a,l+h,a+_),C=hcms_connections_intersectionPoint(p,y,b,g,d,m,d+f,m+u);E&&(p=E.x,y=E.y),C&&(b=C.x,g=C.y),w=Math.abs(g-y),v=Math.abs(b-p),N=Math.sqrt(w*w+v*v)}var F=(g+y)/2-i/2,L=(b+p)/2-N/2,O=[...n.getElementsByClassName("arrow")],A=p>b||p==b&&y<g,M=A&&hcms_connections_isVisible(O[0])&&O[0]||!A&&hcms_connections_isVisible(O[1])&&O[1],B=!A&&hcms_connections_isVisible(O[0])&&O[0]||A&&hcms_connections_isVisible(O[1])&&O[1];M&&(M.classList.remove("arrow-bw"),M.classList.add("arrow-fw"),M.style.borderRightColor=s,M.style.top=i/2-6+"px"),B&&(B.classList.remove("arrow-fw"),B.classList.add("arrow-bw"),B.style.borderLeftColor=s,B.style.top=i/2-6+"px"),"green"==s?(L-=2,F-=hcms_connection_topoffset):"red"==s&&(L+=2,F+=hcms_connection_topoffset),n.style.display="none",n.style["-webkit-transform"]="rotate("+x+"deg)",n.style["-moz-transform"]="rotate("+x+"deg)",n.style["-ms-transform"]="rotate("+x+"deg)",n.style["-o-transform"]="rotate("+x+"deg)",n.style["-transform"]="rotate("+x+"deg)",n.style.top=F+"px",n.style.left=L+"px",n.style.width=N+"px",n.style.height=i+"px",n.style.backgroundColor=s,n.style.background="linear-gradient(to right, "+(M?"transparent":s)+" 11px, "+s+" 11px "+(N-11)+"px, "+(B?"transparent":s)+" "+(N-11)+"px 100%)",n.style.display="initial"}function hcms_connections_repaintConnection(e){var t=e.getAttribute("from"),n=document.querySelector(t),o=e.getAttribute("to"),s=document.querySelector(o),i=e.getElementsByClassName("line")[0];i||((i=document.createElement("div")).classList.add("line"),e.appendChild(i));var c=e.hasAttribute("tail"),r=e.hasAttribute("head"),a=i.getElementsByClassName("arrow"),l=a[0],m=a[1];l||!r&&!c||((l=document.createElement("div")).classList.add("arrow"),i.appendChild(l)),!m&&r&&((m=document.createElement("div")).classList.add("arrow"),i.appendChild(m)),l&&(l.style.visibility=c?"visible":"hidden"),m&&(m.style.visibility=r?"visible":"hidden");var d=i.getElementsByClassName("text")[0],h=e.getAttribute("text");!d&&h&&((d=document.createElement("div")).classList.add("text"),i.appendChild(d)),d&&d.innerText!=h&&(d.innerText=h),hcms_connections_adjustLine(n,s,i,{color:e.getAttribute("color"),onlyVisible:e.hasAttribute("onlyVisible"),fromX:parseFloat(e.getAttribute("fromX")),fromY:parseFloat(e.getAttribute("fromY")),toX:parseFloat(e.getAttribute("toX")),toY:parseFloat(e.getAttribute("toY")),width:parseFloat(e.getAttribute("width"))})}function hcms_connections_repaintConnections(e){if(""!=e){var t=document.getElementsByTagName("connection");if(t.length>0)for(var n=0;n<t.length;n++){if(t[n].id.indexOf(e)>-1)hcms_connections_repaintConnection(document.getElementById(t[n].id))}}}function hcms_connections_createOne(e){hcms_connection_connectionElements.push(e),hcms_connections_repaintConnection(e)}function hcms_connections_create(){[...document.body.getElementsByTagName("connection")].forEach(hcms_connections_createOne)}function hcms_connections_removeConnection(e){for(var t=hcms_connection_connectionElements.length-1;t>=0;t--)hcms_connection_connectionElements[t]===e&&hcms_connection_connectionElements.splice(t,1)}function hcms_connections_bodyNewElement(e){e.forEach(e=>{e.removedNodes.forEach(e=>{e.tagName&&"connection"===e.tagName.toLowerCase()&&hcms_connections_removeConnection(e)}),e.addedNodes.forEach(e=>{e.tagName&&"connection"===e.tagName.toLowerCase()&&hcms_connections_createOne(e)})})}var hcms_connection_connectionElements=[];document.body&&hcms_connections_create()||window.addEventListener("load",hcms_connections_create);